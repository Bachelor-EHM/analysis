---
title: "Analysis_M"
author: "Matilde Jacobsen"
date: "10/20/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---
Setup
```{r setup, include=FALSE}
#Load!
pacman::p_load(readr,tidyverse,dplyr,ggplot2,pastecs,ez,reshape2,stringr,lme4,stats,MuMIn,broom,emmeans,afex,lmerTest,scales,rstatix,ggpubr,magrittr,stats)
#Clean environment
rm(list = ls())
```

#Loading the data
```{r}
color_matching <- read.csv("Cleaned_data/color_matching.csv")
color_naming <- read.csv("Cleaned_data/color_naming.csv")
color_matching_day1 <- read.csv("Cleaned_data/color_matching2020-10-22.csv", sep = ",")
color_naming_day1 <- read.csv("Cleaned_data/color_naming2020-10-22.csv")
color_matching_day6 <- read.csv("Cleaned_data/color_matching2020-10-26.csv")
color_naming_day6 <- read.csv("Cleaned_data/color_naming2020-10-26.csv")
color_matching_all <- read.csv("Cleaned_data/color_matching2020-11-06.csv")
color_naming_all <- read.csv("Cleaned_data/color_naming2020-10-31.csv")
color_matching_posthoc <- read.csv("Cleaned_data/color_matching2020-11-11.csv")

colnames(color_matching_posthoc)
```


#Eva's code


Modelling test data
```{r}

#NB: The is a datapoint included for each chain with the seed coordinates (not a matching). Should no be included IRL.

#Saturation
require(afex)
set_sum_contrasts()
mm1 <- lmer(Saturation ~ Condition + Generation + Color + (0 + Chain|Generation), data = Test2, REML = F, control = lmerControl(
  optimizer = "nloptwrap",
  calc.derivs = F,
  optCtrl = list(
    ftol_abs = 1e-10,
    xtol_abs = 1e-10,
    maxeval = 10000
  )))
summary(mm1)

#Hue angle
#What is the matter with 0 or 1 in random effects? 
require(afex)
set_sum_contrasts()
mm2 <- lmer(Rel_Dif ~ Condition + Generation + Color + (0 + Chain|Generation), data = Test2, REML = F, control = lmerControl(
  optimizer = "nloptwrap",
  calc.derivs = F,
  optCtrl = list(
    ftol_abs = 1e-10,
    xtol_abs = 1e-10,
    maxeval = 10000
  )))
summary(mm2)

```

Visualizations
```{r}
#Omit rows with NAs
Test2 <- na.omit(Test2)

#Hue
ggplot(Test2,aes(Generation, Rel_Dif))+geom_point()

#Saturation
ggplot(Test2,aes(Generation, Saturation))+geom_point()

#Boxplots
color_sat <- ggboxplot(
  Test2, x = "Color", y = "Saturation",
  color = "Condition", palette = "jco"
  )
color_sat

color_hue <- ggboxplot(
  Test2, x = "Color", y = "Rel_Dif",
  color = "Condition", palette = "jco"
  )
color_hue

cond_sat <- ggboxplot(
  Test2, x = "Condition", y = "Saturation",
  color = "Color", palette = "jco"
  )
cond_sat

cond_hue <- ggboxplot(
  Test2, x = "Condition", y = "Rel_Dif",
  color = "Color", palette = "jco"
  )
cond_hue

#Trying out a line plot
color_sat_line <- ggplot(Test2, aes(x=Generation,y=Saturation,group=Color))+
  geom_line(stat="summary") +
  expand_limits(y=0) +
  xlab("Generations") + ylab("Saturation %") +
  ggtitle("Plot")
color_sat_line

color_hue_line <- ggplot(Test2, aes(x=Generation,y=Rel_Dif,group=Color))+
  geom_line(stat="summary") +
  expand_limits(y=0) +
  xlab("Generation") + ylab("Relative difference %") +
  ggtitle("Plot")
color_hue_line

cond_sat_line <- ggplot(Test2, aes(x=Generation,y=Saturation,group=Condition))+
  geom_line(stat="summary") +
  expand_limits(y=0) +
  xlab("Generations") + ylab("Saturation %") +
  ggtitle("Plot")
cond_sat_line

cond_hue_line <- ggplot(Test2, aes(x=Generation,y=Rel_Dif,group=Condition))+
  geom_line(stat="summary") +
  expand_limits(y=0) +
  xlab("Generation") + ylab("Relative difference %") +
  ggtitle("Plot")
cond_hue_line


```


#Using real data


Modelling cleaned data
NB: does not have enough data yet...
```{r}
color_matching <- color_matching_all

#Very simple model
simple_m_sat <- lm(Saturation_matched ~ Generation + Color_label_matched, data = color_matching)
summary(simple_m_sat)

simple_m_hue <- lm(Rel_dif ~ Generation + Color_label_matched, data = danish)
summary(simple_m_hue)

simple_m_hue_y <- lm(Rel_dif ~ Generation, data = d_yellow)
summary(simple_m_hue_y)
simple_m_hue_b <- lm(Rel_dif ~ Generation, data = d_blue)
summary(simple_m_hue_b)

simple_m_hue_r <- lm(Rel_dif ~ Generation, data = d_red)
summary(simple_m_hue_r)
simple_m_hue_g <- lm(Rel_dif ~ Generation, data = d_green)
summary(simple_m_hue_g)

#Secondary hues
simple_m_hue_y2 <- lm(Rel_dif_2 ~ Generation, data = d_yellow)
summary(simple_m_hue_y2)
simple_m_hue_b <- lm(Rel_dif ~ Generation, data = d_blue)
summary(simple_m_hue_b)

simple_m_hue_r2 <- lm(Rel_dif_2 ~ Generation, data = d_red)
summary(simple_m_hue_r2)
simple_m_hue_g <- lm(Rel_dif ~ Generation, data = d_green)
summary(simple_m_hue_g)



#NB: The is a datapoint included for each chain with the seed coordinates (not a matching). Should no be included IRL.

#Saturation
require(afex)
set_sum_contrasts()
model1 <- lmer(Saturation_matched ~ Condition + Generation + Color_label_matched + (0 + Chain|Generation), data = danish, REML = F, control = lmerControl(
  optimizer = "nloptwrap",
  calc.derivs = F,
  optCtrl = list(
    ftol_abs = 1e-10,
    xtol_abs = 1e-10,
    maxeval = 10000
  )))
summary(model1)

#Hue angle
#What is the matter with 0 or 1 in random effects? 
require(afex)
set_sum_contrasts()
model2 <- lmer(Rel_dif ~ Condition + Generation + Color_label_matched + (0 + Chain|Generation), data = danish, REML = F, control = lmerControl(
  optimizer = "nloptwrap",
  calc.derivs = F,
  optCtrl = list(
    ftol_abs = 1e-10,
    xtol_abs = 1e-10,
    maxeval = 10000
  )))
summary(model2)

```

